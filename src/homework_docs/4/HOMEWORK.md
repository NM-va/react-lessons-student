# Домашнее задание: Составной компонент DataDetail с формой

## Введение

В этом задании вам предстоит создать составной компонент `DataDetail`, который будет реализовывать концепции составных компонентов, слотов, контекста и императивного API. Компонент должен быть гибким, расширяемым и интуитивно понятным для использования.

## Цель задания

Разработать составной компонент `DataDetail`, который:

1. Имеет четкую структуру с выделенными частями (header, body, footer, actions)
2. Использует контекст для обмена данными между подкомпонентами
3. Предоставляет императивный API для управления компонентом извне
4. Интегрируется с имеющимся контекстом темы (useThemeColor)
5. Поддерживает форму внутри с использованием `UniversalInput` из предыдущего задания

## Требования

### Базовый уровень (обязательно)

1. **Структура составного компонента**:
   - `DataDetail` - основной компонент
   - `DataDetail.Header` - заголовок с возможностью сворачивания/разворачивания
   - `DataDetail.Body` - основное содержимое
   - `DataDetail.Footer` - нижняя часть с действиями
   - `DataDetail.Actions` - дополнительные действия в заголовке

2. **Контекст**:
   - Создайте контекст `DataDetailContext` для обмена данными между подкомпонентами
   - Реализуйте кастомный хук `useDataDetail()` для доступа к контексту
   - Контекст должен содержать как минимум состояние развернутости и функцию переключения

3. **Императивный API**:
   - Используйте `forwardRef` и `useImperativeHandle` для создания API компонента
   - Реализуйте методы:
     - `open()` - развернуть компонент
     - `close()` - свернуть компонент
     - `toggle()` - переключить состояние

4. **Интеграция с темой**:
   - Используйте хук `useThemeColor` для стилизации компонента
   - Компонент должен корректно отображаться как в светлой, так и в темной теме

5. **Типизация**:
   - Определите четкие интерфейсы для пропсов всех компонентов
   - Определите интерфейс для императивных методов
   - Определите типы для контекста

### Продвинутый уровень

1. **Интеграция с UniversalInput**:
   - Реализуйте компонент `DataForm` внутри `DataDetail.Body`
   - Используйте `UniversalInput` из предыдущего задания для полей формы
   - Создайте контекст формы для управления значениями и валидацией

2. **Расширенный императивный API**:
   - Добавьте методы для работы с формой:
     - `resetForm()` - сброс значений формы
     - `validateForm()` - валидация всех полей формы
     - `submitForm()` - отправка формы
     - `getFormValues()` - получение текущих значений формы

3. **Анимации и переходы**:
   - Добавьте плавные анимации при сворачивании/разворачивании
   - Реализуйте transition для появления/скрытия содержимого

4. **Обработка сложных сценариев**:
   - Поддержка вложенных `DataDetail`
   - Возможность программного управления формой
   - Обработка зависимостей между полями формы

## Пример использования

Базовое использование:

```jsx
// Создаем ref для доступа к императивным методам
const dataDetailRef = useRef(null);

// Используем компонент
<DataDetail 
  ref={dataDetailRef}
  title="Информация о пользователе"
>
  <DataDetail.Body>
    <div className="form-grid">
      <div>
        <label>Имя:</label>
        <input type="text" defaultValue="Иван" />
      </div>
      <div>
        <label>Email:</label>
        <input type="email" defaultValue="ivan@example.com" />
      </div>
    </div>
  </DataDetail.Body>
  <DataDetail.Footer>
    <div className="actions-container">
      <button onClick={() => dataDetailRef.current.close()}>Отмена</button>
      <button onClick={handleSave}>Сохранить</button>
    </div>
  </DataDetail.Footer>
</DataDetail>

// Использование императивных методов
<button onClick={() => dataDetailRef.current.open()}>Открыть</button>
<button onClick={() => dataDetailRef.current.close()}>Закрыть</button>
```

Продвинутое использование с формой:

```jsx
const dataDetailRef = useRef(null);

// Обработчики формы
const handleSubmit = (formData) => {
  console.log('Отправка данных:', formData);
};

const handleCancel = () => {
  dataDetailRef.current.resetForm();
  dataDetailRef.current.close();
};

// Использование с DataForm
<DataDetail ref={dataDetailRef} title="Редактирование профиля">
  <DataDetail.Header>
    <span>Редактирование профиля пользователя</span>
    <DataDetail.Actions>
      <button onClick={() => dataDetailRef.current.resetForm()}>Сбросить</button>
    </DataDetail.Actions>
  </DataDetail.Header>
  
  <DataDetail.Body>
    <DataForm onSubmit={handleSubmit} id="profileForm">
      <div className="form-row">
        <UniversalInput
          name="firstName"
          label="Имя"
          defaultValue="Иван"
          validation={(value) => !value ? "Имя обязательно" : ""}
        />
      </div>
      <div className="form-row">
        <UniversalInput
          name="lastName"
          label="Фамилия"
          defaultValue="Иванов"
          validation={(value) => !value ? "Фамилия обязательна" : ""}
        />
      </div>
      <div className="form-row">
        <UniversalInput
          name="email"
          label="Email"
          type="email"
          defaultValue="ivan@example.com"
          validation={(value) => {
            if (!value) return "Email обязателен";
            if (!/\S+@\S+\.\S+/.test(value)) return "Некорректный формат email";
            return "";
          }}
        />
      </div>
    </DataForm>
  </DataDetail.Body>
  
  <DataDetail.Footer>
    <div className="actions-container">
      <button onClick={handleCancel}>Отмена</button>
      <button onClick={() => dataDetailRef.current.submitForm()}>Сохранить</button>
    </div>
  </DataDetail.Footer>
</DataDetail>
```

## Шаблон для начала работы

```jsx
import React, { createContext, useContext, forwardRef, useImperativeHandle, useState, ReactNode } from 'react';
import { useThemeColor } from '../hooks/useThemeColor';

// Определение типов
interface DataDetailProps {
  children: ReactNode;
  className?: string;
  title?: string;
  expanded?: boolean;
  onExpand?: (expanded: boolean) => void;
}

// Определение контекста
interface DataDetailContextType {
  expanded: boolean;
  toggleExpand: () => void;
}

// Создание контекста
const DataDetailContext = createContext<DataDetailContextType | undefined>(undefined);

// Хук для использования контекста
export const useDataDetail = () => {
  const context = useContext(DataDetailContext);
  if (!context) {
    throw new Error('useDataDetail must be used within a DataDetail component');
  }
  return context;
};

// Интерфейс для императивного хэндла
export interface DataDetailHandles {
  open: () => void;
  close: () => void;
  toggle: () => void;
  // Для продвинутого уровня:
  // resetForm?: () => void;
  // validateForm?: () => boolean;
  // submitForm?: () => void;
  // getFormValues?: () => Record<string, any>;
}

// Основной компонент с forwardRef
const DataDetail = forwardRef<DataDetailHandles, DataDetailProps>((props, ref) => {
  // TODO: Реализуйте основной компонент

  return (
    <DataDetailContext.Provider value={/* значение контекста */}>
      {/* Структура компонента */}
    </DataDetailContext.Provider>
  );
});

// Подкомпоненты
DataDetail.Header = /* TODO */;
DataDetail.Body = /* TODO */;
DataDetail.Footer = /* TODO */;
DataDetail.Actions = /* TODO */;

export default DataDetail;
```

## Критерии оценки

### Базовый уровень (60%)

1. **Структура компонента (20%)**:
   - Корректно реализованы все подкомпоненты
   - Поддерживается использование заголовка через `title` или через `DataDetail.Header`
   - Компоненты корректно отображаются в зависимости от состояния развернутости

2. **Контекст и связь компонентов (15%)**:
   - Правильно настроен контекст для обмена данными между компонентами
   - Реализован и корректно работает хук `useDataDetail`
   - Контекст имеет проверку на существование

3. **Императивный API (15%)**:
   - Корректно реализованы методы `open()`, `close()` и `toggle()`
   - Методы работают как ожидается и обновляют состояние компонента
   - Компонент корректно обрабатывает внешние обратные вызовы (например, `onExpand`)

4. **Интеграция с темой (10%)**:
   - Компонент корректно использует `useThemeColor`
   - Все подкомпоненты правильно стилизованы в зависимости от темы
   - Компонент хорошо выглядит как в светлой, так и в темной теме

### Продвинутый уровень (40%)

5. **Интеграция с формой (15%)**:
   - Реализована интеграция с `UniversalInput`
   - Создана система для управления формой внутри `DataDetail`
   - Форма и поля корректно функционируют

6. **Расширенный императивный API (10%)**:
   - Реализованы дополнительные методы для работы с формой
   - Методы корректно взаимодействуют с формой внутри компонента
   - API интуитивно понятен и удобен для использования

7. **Анимации и UX (10%)**:
   - Реализованы плавные анимации при сворачивании/разворачивании
   - Улучшения UX (фокус, доступность, отзывчивость)
   - Дополнительные визуальные улучшения

8. **Обработка сложных сценариев (5%)**:
   - Поддержка вложенных компонентов
   - Обработка краевых случаев
   - Продуманная обработка ошибок

## Дополнительные рекомендации

1. **Начните с базовой структуры**:
   - Сначала реализуйте базовый компонент и подкомпоненты
   - Добавьте контекст и базовую функциональность
   - Постепенно расширяйте компонент продвинутыми возможностями

2. **Используйте TypeScript для улучшения качества кода**:
   - Определите четкие интерфейсы для всех компонентов и функций
   - Используйте дженерики для более гибкой типизации, где это необходимо
   - Добавьте документацию типов (JSDoc) для улучшения понимания кода

3. **Тестируйте свой компонент**:
   - Проверяйте работу компонента в разных сценариях использования
   - Убедитесь, что императивные методы работают как ожидается
   - Проверьте реакцию компонента на различные входные данные

4. **Документируйте свой код**:
   - Добавьте JSDoc комментарии к основным функциям и компонентам
   - Создайте пример использования для демонстрации возможностей компонента
   - Опишите API вашего компонента для других разработчиков

## Сроки и формат сдачи

- **Базовый уровень**: до следующего занятия
- **Продвинутый уровень**: в течение недели после следующего занятия

Результаты работы должны быть представлены в виде:

1. Исходного кода компонента (`DataDetail.tsx`)
2. Демонстрационного компонента (`DataDetailDemo.tsx`), показывающего использование вашего компонента
3. Краткого описания реализованных возможностей и особенностей вашего решения

## Дополнительные задания для самостоятельной практики

Если вы хотите углубить свои знания, попробуйте выполнить эти дополнительные задания:

1. **Интеграция с порталами React**:
   - Доработайте компонент для поддержки рендеринга через порталы
   - Добавьте возможность отображения в модальном режиме

2. **Кастомные анимации**:
   - Добавьте несколько вариантов анимаций для сворачивания/разворачивания
   - Реализуйте API для выбора типа анимации

3. **Расширенная валидация формы**:
   - Добавьте асинхронную валидацию полей (например, проверка уникальности через API)
   - Реализуйте зависимые поля, влияющие на валидацию друг друга

4. **Подключение к глобальному состоянию**:
   - Добавьте возможность интеграции с глобальными менеджерами состояния (Redux, MobX, Recoil и т.д.)
   - Реализуйте автоматическую синхронизацию формы с глобальным состоянием

## Подсказки и рекомендации

- **Для контекста**: используйте паттерн "поиск и предоставление" (search and provide pattern) - явно выдавайте ошибку, если контекст используется вне провайдера
- **Для императивного API**: не забудьте правильно обрабатывать зависимости в useImperativeHandle для обновления методов при изменении зависимых состояний
- **Для UniversalInput**: создайте обертку над UniversalInput, которая будет интегрироваться с контекстом формы в DataDetail
- **Для анимаций**: используйте CSS-переходы для простых анимаций и React Transition Group или Framer Motion для более сложных
